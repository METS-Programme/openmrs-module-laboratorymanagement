-- esmugemr.labmgmt_approval_config definition

CREATE TABLE `labmgmt_approval_config` (
  `approval_config_id` int NOT NULL AUTO_INCREMENT,
  `approval_title` varchar(100) NOT NULL,
  `privilege` varchar(255) NOT NULL,
  `pending_status` varchar(100) NOT NULL,
  `returned_status` varchar(100) NOT NULL,
  `rejected_status` varchar(100) NOT NULL,
  `approved_status` varchar(100) NOT NULL,
  `creator` int NOT NULL DEFAULT '0',
  `date_created` datetime NOT NULL,
  `changed_by` int DEFAULT NULL,
  `date_changed` datetime DEFAULT NULL,
  `voided` tinyint(1) NOT NULL DEFAULT '0',
  `voided_by` int DEFAULT NULL,
  `date_voided` datetime DEFAULT NULL,
  `void_reason` varchar(255) DEFAULT NULL,
  `uuid` char(38) NOT NULL,
  PRIMARY KEY (`approval_config_id`),
  UNIQUE KEY `uuid` (`uuid`),
  KEY `labmgmt_approval_config_changed_by_fk` (`changed_by`),
  KEY `labmgmt_approval_config_creator_fk` (`creator`),
  KEY `labmgmt_approval_config_voided_by_fk` (`voided_by`),
  CONSTRAINT `labmgmt_approval_config_changed_by_fk` FOREIGN KEY (`changed_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_approval_config_creator_fk` FOREIGN KEY (`creator`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_approval_config_voided_by_fk` FOREIGN KEY (`voided_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb3;


-- esmugemr.labmgmt_approval_flow definition

CREATE TABLE `labmgmt_approval_flow` (
  `approval_flow_id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(100) DEFAULT NULL,
  `system_name` varchar(50) DEFAULT NULL,
  `level_one` int DEFAULT NULL,
  `level_two` int DEFAULT NULL,
  `level_three` int DEFAULT NULL,
  `level_four` int DEFAULT NULL,
  `level_one_allow_owner` tinyint(1) DEFAULT NULL,
  `level_two_allow_owner` tinyint(1) DEFAULT NULL,
  `level_three_allow_owner` tinyint(1) DEFAULT NULL,
  `level_four_allow_owner` tinyint(1) DEFAULT NULL,
  `level_two_allow_previous` tinyint(1) DEFAULT NULL,
  `level_three_allow_previous` tinyint(1) DEFAULT NULL,
  `level_four_allow_previous` tinyint(1) DEFAULT NULL,
  `creator` int NOT NULL DEFAULT '0',
  `date_created` datetime NOT NULL,
  `changed_by` int DEFAULT NULL,
  `date_changed` datetime DEFAULT NULL,
  `voided` tinyint(1) NOT NULL DEFAULT '0',
  `voided_by` int DEFAULT NULL,
  `date_voided` datetime DEFAULT NULL,
  `void_reason` varchar(255) DEFAULT NULL,
  `uuid` char(38) NOT NULL,
  PRIMARY KEY (`approval_flow_id`),
  UNIQUE KEY `uuid` (`uuid`),
  UNIQUE KEY `system_name` (`system_name`),
  KEY `labmgmt_approval_flow_changed_by_fk` (`changed_by`),
  KEY `labmgmt_approval_flow_creator_fk` (`creator`),
  KEY `labmgmt_approval_flow_level_four_fk` (`level_four`),
  KEY `labmgmt_approval_flow_level_one_fk` (`level_one`),
  KEY `labmgmt_approval_flow_level_three_fk` (`level_three`),
  KEY `labmgmt_approval_flow_level_two_fk` (`level_two`),
  KEY `labmgmt_approval_flow_voided_by_fk` (`voided_by`),
  CONSTRAINT `labmgmt_approval_flow_changed_by_fk` FOREIGN KEY (`changed_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_approval_flow_creator_fk` FOREIGN KEY (`creator`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_approval_flow_level_four_fk` FOREIGN KEY (`level_four`) REFERENCES `labmgmt_approval_config` (`approval_config_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_approval_flow_level_one_fk` FOREIGN KEY (`level_one`) REFERENCES `labmgmt_approval_config` (`approval_config_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_approval_flow_level_three_fk` FOREIGN KEY (`level_three`) REFERENCES `labmgmt_approval_config` (`approval_config_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_approval_flow_level_two_fk` FOREIGN KEY (`level_two`) REFERENCES `labmgmt_approval_config` (`approval_config_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_approval_flow_voided_by_fk` FOREIGN KEY (`voided_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb3;


-- esmugemr.labmgmt_sample definition

CREATE TABLE `labmgmt_sample` (
  `sample_id` int NOT NULL AUTO_INCREMENT,
  `parent_sample_id` int DEFAULT NULL,
  `sample_type_id` int NOT NULL,
  `at_location_id` int DEFAULT NULL,
  `container_type_id` int DEFAULT NULL,
  `collected_by` int DEFAULT NULL,
  `collection_date` datetime DEFAULT NULL,
  `container_count` int DEFAULT NULL,
  `accession_number` varchar(255) DEFAULT NULL,
  `provided_ref` varchar(255) DEFAULT NULL,
  `external_ref` varchar(100) DEFAULT NULL,
  `referred_out` tinyint(1) DEFAULT NULL,
  `creator` int NOT NULL DEFAULT '0',
  `date_created` datetime NOT NULL,
  `changed_by` int DEFAULT NULL,
  `date_changed` datetime DEFAULT NULL,
  `voided` tinyint(1) NOT NULL DEFAULT '0',
  `voided_by` int DEFAULT NULL,
  `date_voided` datetime DEFAULT NULL,
  `void_reason` varchar(255) DEFAULT NULL,
  `uuid` char(38) NOT NULL,
  `current_sample_activity` int DEFAULT NULL,
  `status` varchar(50) NOT NULL,
  PRIMARY KEY (`sample_id`),
  UNIQUE KEY `uuid` (`uuid`),
  KEY `labmgmt_sample_at_location_fk` (`at_location_id`),
  KEY `labmgmt_sample_changed_by_fk` (`changed_by`),
  KEY `labmgmt_sample_collected_by_fk` (`collected_by`),
  KEY `labmgmt_sample_container_type_fk` (`container_type_id`),
  KEY `labmgmt_sample_creator_fk` (`creator`),
  KEY `labmgmt_sample_parent_sample_fk` (`parent_sample_id`),
  KEY `labmgmt_sample_sample_type_fk` (`sample_type_id`),
  KEY `labmgmt_sample_voided_by_fk` (`voided_by`),
  CONSTRAINT `labmgmt_sample_at_location_fk` FOREIGN KEY (`at_location_id`) REFERENCES `location` (`location_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_sample_changed_by_fk` FOREIGN KEY (`changed_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_sample_collected_by_fk` FOREIGN KEY (`collected_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_sample_container_type_fk` FOREIGN KEY (`container_type_id`) REFERENCES `concept` (`concept_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_sample_creator_fk` FOREIGN KEY (`creator`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_sample_parent_sample_fk` FOREIGN KEY (`parent_sample_id`) REFERENCES `labmgmt_sample` (`sample_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_sample_sample_type_fk` FOREIGN KEY (`sample_type_id`) REFERENCES `concept` (`concept_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_sample_voided_by_fk` FOREIGN KEY (`voided_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;


-- esmugemr.labmgmt_sample_activity definition

CREATE TABLE `labmgmt_sample_activity` (
  `sample_activity_id` int NOT NULL AUTO_INCREMENT,
  `sample_id` int DEFAULT NULL,
  `activity_type` varchar(50) NOT NULL,
  `source_id` int NOT NULL,
  `destination_id` int NOT NULL,
  `source_state` varchar(50) NOT NULL,
  `destination_state` varchar(50) NOT NULL,
  `activity_by` int NOT NULL,
  `remarks` varchar(500) DEFAULT NULL,
  `status` varchar(50) NOT NULL,
  `to_sample_id` int DEFAULT NULL,
  `reused_checkout` int DEFAULT NULL,
  `volume` decimal(18,4) DEFAULT NULL,
  `thaw_cycles` int DEFAULT NULL,
  `creator` int NOT NULL DEFAULT '0',
  `date_created` datetime NOT NULL,
  `changed_by` int DEFAULT NULL,
  `date_changed` datetime DEFAULT NULL,
  `voided` tinyint(1) NOT NULL DEFAULT '0',
  `voided_by` int DEFAULT NULL,
  `date_voided` datetime DEFAULT NULL,
  `void_reason` varchar(255) DEFAULT NULL,
  `uuid` char(38) NOT NULL,
  PRIMARY KEY (`sample_activity_id`),
  UNIQUE KEY `uuid` (`uuid`),
  KEY `labmgmt_sample_activity_changed_by_fk` (`changed_by`),
  KEY `labmgmt_sample_activity_creator_fk` (`creator`),
  KEY `labmgmt_sample_activity_dest_fk` (`destination_id`),
  KEY `labmgmt_sample_activity_frm_sample_fk` (`sample_id`),
  KEY `labmgmt_sample_activity_mv_by_fk` (`activity_by`),
  KEY `labmgmt_sample_activity_reuse_fk` (`reused_checkout`),
  KEY `labmgmt_sample_activity_src_fk` (`source_id`),
  KEY `labmgmt_sample_activity_to_sample_fk` (`to_sample_id`),
  KEY `labmgmt_sample_activity_voided_by_fk` (`voided_by`),
  CONSTRAINT `labmgmt_sample_activity_changed_by_fk` FOREIGN KEY (`changed_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_sample_activity_creator_fk` FOREIGN KEY (`creator`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_sample_activity_dest_fk` FOREIGN KEY (`destination_id`) REFERENCES `location` (`location_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_sample_activity_frm_sample_fk` FOREIGN KEY (`sample_id`) REFERENCES `labmgmt_sample` (`sample_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_sample_activity_mv_by_fk` FOREIGN KEY (`activity_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_sample_activity_reuse_fk` FOREIGN KEY (`reused_checkout`) REFERENCES `labmgmt_sample_activity` (`sample_activity_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_sample_activity_src_fk` FOREIGN KEY (`source_id`) REFERENCES `location` (`location_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_sample_activity_to_sample_fk` FOREIGN KEY (`to_sample_id`) REFERENCES `location` (`location_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_sample_activity_voided_by_fk` FOREIGN KEY (`voided_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;


-- esmugemr.labmgmt_test_approval definition

CREATE TABLE `labmgmt_test_approval` (
  `test_approval_id` int NOT NULL AUTO_INCREMENT,
  `approval_flow_id` int NOT NULL,
  `approval_config_id` int NOT NULL,
  `approval_result` varchar(100) DEFAULT NULL,
  `remarks` varchar(500) DEFAULT NULL,
  `activated_date` datetime DEFAULT NULL,
  `approval_date` datetime DEFAULT NULL,
  `approved_by` int DEFAULT NULL,
  `next_approval_id` int DEFAULT NULL,
  `remaining_levels` int NOT NULL,
  `creator` int NOT NULL DEFAULT '0',
  `date_created` datetime NOT NULL,
  `changed_by` int DEFAULT NULL,
  `date_changed` datetime DEFAULT NULL,
  `voided` tinyint(1) NOT NULL DEFAULT '0',
  `voided_by` int DEFAULT NULL,
  `date_voided` datetime DEFAULT NULL,
  `void_reason` varchar(255) DEFAULT NULL,
  `uuid` char(38) NOT NULL,
  `test_result_id` int NOT NULL,
  PRIMARY KEY (`test_approval_id`),
  UNIQUE KEY `uuid` (`uuid`),
  KEY `labmgmt_test_approval_approval_by_fk` (`approved_by`),
  KEY `labmgmt_test_approval_changed_by_fk` (`changed_by`),
  KEY `labmgmt_test_approval_config_fk` (`approval_config_id`),
  KEY `labmgmt_test_approval_creator_fk` (`creator`),
  KEY `labmgmt_test_approval_next_approval_fk` (`next_approval_id`),
  KEY `labmgmt_test_approval_voided_by_fk` (`voided_by`),
  KEY `labmgmt_test_approval_flow_fk` (`approval_flow_id`),
  KEY `labmgmt_test_approval_test_result_fk` (`test_result_id`),
  CONSTRAINT `labmgmt_test_approval_approval_by_fk` FOREIGN KEY (`approved_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_approval_changed_by_fk` FOREIGN KEY (`changed_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_approval_config_fk` FOREIGN KEY (`approval_config_id`) REFERENCES `labmgmt_approval_config` (`approval_config_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_approval_creator_fk` FOREIGN KEY (`creator`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_approval_flow_fk` FOREIGN KEY (`approval_flow_id`) REFERENCES `labmgmt_approval_flow` (`approval_flow_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_approval_next_approval_fk` FOREIGN KEY (`next_approval_id`) REFERENCES `labmgmt_test_approval` (`test_approval_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_approval_test_result_fk` FOREIGN KEY (`test_result_id`) REFERENCES `labmgmt_test_result` (`test_result_id`),
  CONSTRAINT `labmgmt_test_approval_voided_by_fk` FOREIGN KEY (`voided_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;


-- esmugemr.labmgmt_test_config definition

CREATE TABLE `labmgmt_test_config` (
  `test_config_id` int NOT NULL AUTO_INCREMENT,
  `test_id` int NOT NULL,
  `require_approval` tinyint(1) NOT NULL,
  `approval_flow_id` int DEFAULT NULL,
  `test_group_id` int DEFAULT NULL,
  `enabled` tinyint(1) NOT NULL,
  `creator` int NOT NULL DEFAULT '0',
  `date_created` datetime NOT NULL,
  `changed_by` int DEFAULT NULL,
  `date_changed` datetime DEFAULT NULL,
  `voided` tinyint(1) NOT NULL DEFAULT '0',
  `voided_by` int DEFAULT NULL,
  `date_voided` datetime DEFAULT NULL,
  `void_reason` varchar(255) DEFAULT NULL,
  `uuid` char(38) NOT NULL,
  PRIMARY KEY (`test_config_id`),
  UNIQUE KEY `test_id` (`test_id`),
  KEY `labmgmt_test_config_changed_by_fk` (`changed_by`),
  KEY `labmgmt_test_config_creator_fk` (`creator`),
  KEY `labmgmt_test_config_group_fk` (`test_group_id`),
  KEY `labmgmt_test_config_appflow_fk` (`approval_flow_id`),
  KEY `labmgmt_test_config_voided_by_fk` (`voided_by`),
  CONSTRAINT `labmgmt_test_config_appflow_fk` FOREIGN KEY (`approval_flow_id`) REFERENCES `labmgmt_approval_flow` (`approval_flow_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_config_changed_by_fk` FOREIGN KEY (`changed_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_config_creator_fk` FOREIGN KEY (`creator`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_config_group_fk` FOREIGN KEY (`test_group_id`) REFERENCES `concept` (`concept_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_config_test_fk` FOREIGN KEY (`test_id`) REFERENCES `concept` (`concept_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_config_voided_by_fk` FOREIGN KEY (`voided_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE=InnoDB AUTO_INCREMENT=70 DEFAULT CHARSET=utf8mb3;


-- esmugemr.labmgmt_test_request definition

CREATE TABLE `labmgmt_test_request` (
  `test_request_id` int NOT NULL AUTO_INCREMENT,
  `patient_id` int NOT NULL,
  `visit_id` int DEFAULT NULL,
  `encounter_id` int NOT NULL,
  `provider_id` int DEFAULT NULL,
  `request_date` datetime NOT NULL,
  `request_no` varchar(100) DEFAULT NULL,
  `urgency` varchar(50) NOT NULL,
  `creator` int NOT NULL DEFAULT '0',
  `care_setting_id` int DEFAULT NULL,
  `date_created` datetime NOT NULL,
  `date_stopped` datetime DEFAULT NULL,
  `changed_by` int DEFAULT NULL,
  `status` varchar(50) NOT NULL,
  `date_changed` datetime DEFAULT NULL,
  `voided` tinyint(1) NOT NULL DEFAULT '0',
  `voided_by` int DEFAULT NULL,
  `date_voided` datetime DEFAULT NULL,
  `void_reason` varchar(255) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci DEFAULT NULL,
  `uuid` char(38) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci NOT NULL,
  `at_location_id` int NOT NULL,
  `referred_in` tinyint(1) NOT NULL,
  `referral_from_facility_id` int DEFAULT NULL,
  `referral_from_facility_name` varchar(255) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci DEFAULT NULL,
  `referral_in_external_ref` varchar(50) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci DEFAULT NULL,
  PRIMARY KEY (`test_request_id`),
  UNIQUE KEY `uuid` (`uuid`),
  KEY `labmgmt_test_request_patient_fk` (`patient_id`),
  KEY `labmgmt_test_request_visit_fk` (`visit_id`),
  KEY `labmgmt_test_request_encounter_fk` (`encounter_id`),
  KEY `labmgmt_test_request_provider_fk` (`provider_id`),
  KEY `labmgmt_test_request_care_setting_fk` (`care_setting_id`),
  KEY `labmgmt_test_request_changed_by_fk` (`changed_by`),
  KEY `labmgmt_test_request_creator_fk` (`creator`),
  KEY `labmgmt_test_request_voided_by_fk` (`voided_by`),
  KEY `labmgmt_test_request_FK` (`referral_from_facility_id`),
  CONSTRAINT `labmgmt_test_request_care_setting_fk` FOREIGN KEY (`care_setting_id`) REFERENCES `care_setting` (`care_setting_id`),
  CONSTRAINT `labmgmt_test_request_changed_by_fk` FOREIGN KEY (`changed_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_request_creator_fk` FOREIGN KEY (`creator`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_request_encounter_fk` FOREIGN KEY (`encounter_id`) REFERENCES `encounter` (`encounter_id`),
  CONSTRAINT `labmgmt_test_request_FK` FOREIGN KEY (`referral_from_facility_id`) REFERENCES `concept` (`concept_id`),
  CONSTRAINT `labmgmt_test_request_patient_fk` FOREIGN KEY (`patient_id`) REFERENCES `patient` (`patient_id`),
  CONSTRAINT `labmgmt_test_request_provider_fk` FOREIGN KEY (`provider_id`) REFERENCES `provider` (`provider_id`),
  CONSTRAINT `labmgmt_test_request_visit_fk` FOREIGN KEY (`visit_id`) REFERENCES `visit` (`visit_id`),
  CONSTRAINT `labmgmt_test_request_voided_by_fk` FOREIGN KEY (`voided_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;


-- esmugemr.labmgmt_test_request_item definition

CREATE TABLE `labmgmt_test_request_item` (
  `test_request_item_id` int NOT NULL AUTO_INCREMENT,
  `order_id` int NOT NULL,
  `at_location_id` int NOT NULL,
  `to_location_id` int DEFAULT NULL,
  `referred_out` tinyint(1) NOT NULL,
  `status` varchar(50) NOT NULL,
  `encounter_id` int NOT NULL,
  `referral_out_origin` varchar(50) DEFAULT NULL,
  `referral_out_by` int DEFAULT NULL,
  `referral_out_date` datetime DEFAULT NULL,
  `referral_to_facility_id` int DEFAULT NULL,
  `referral_to_facility_name` varchar(255) DEFAULT NULL,
  `require_request_approval` tinyint(1) DEFAULT NULL,
  `request_approval_result` varchar(50) DEFAULT NULL,
  `request_approval_by` int DEFAULT NULL,
  `request_approval_date` datetime DEFAULT NULL,
  `request_approval_remarks` varchar(500) DEFAULT NULL,
  `initial_sample_id` int DEFAULT NULL,
  `final_result_id` int DEFAULT NULL,
  `creator` int NOT NULL DEFAULT '0',
  `date_created` datetime NOT NULL,
  `changed_by` int DEFAULT NULL,
  `date_changed` datetime DEFAULT NULL,
  `voided` tinyint(1) NOT NULL DEFAULT '0',
  `voided_by` int DEFAULT NULL,
  `date_voided` datetime DEFAULT NULL,
  `void_reason` varchar(255) DEFAULT NULL,
  `uuid` char(38) NOT NULL,
  `referral_out_sample_id` int DEFAULT NULL,
  `test_request_id` int NOT NULL,
  PRIMARY KEY (`test_request_item_id`),
  UNIQUE KEY `uuid` (`uuid`),
  KEY `labmgmt_test_request_item_at_location_fk` (`at_location_id`),
  KEY `labmgmt_test_request_item_changed_by_fk` (`changed_by`),
  KEY `labmgmt_test_request_item_final_result_id_idx` (`final_result_id`),
  KEY `labmgmt_test_request_item_initial_sample_id_idx` (`initial_sample_id`),
  KEY `labmgmt_test_request_item_creator_fk` (`creator`),
  KEY `labmgmt_test_request_item_encounter_fk` (`encounter_id`),
  KEY `labmgmt_test_request_item_order_fk` (`order_id`),
  KEY `labmgmt_test_request_item_referral_out_by_fk` (`referral_out_by`),
  KEY `labmgmt_test_request_item_referral_to_facility_fk` (`referral_to_facility_id`),
  KEY `labmgmt_test_request_item_request_approval_by_fk` (`request_approval_by`),
  KEY `labmgmt_test_request_item_to_location_fk` (`to_location_id`),
  KEY `labmgmt_test_request_item_voided_by_fk` (`voided_by`),
  KEY `labmgmt_test_request_item_refout_sample_fk` (`referral_out_sample_id`),
  KEY `labmgmt_test_request_item_request_fk` (`test_request_id`),
  CONSTRAINT `labmgmt_test_request_item_at_location_fk` FOREIGN KEY (`at_location_id`) REFERENCES `location` (`location_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_request_item_changed_by_fk` FOREIGN KEY (`changed_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_request_item_creator_fk` FOREIGN KEY (`creator`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_request_item_encounter_fk` FOREIGN KEY (`encounter_id`) REFERENCES `encounter` (`encounter_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_request_item_order_fk` FOREIGN KEY (`order_id`) REFERENCES `orders` (`order_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_request_item_referral_out_by_fk` FOREIGN KEY (`referral_out_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_request_item_referral_to_facility_fk` FOREIGN KEY (`referral_to_facility_id`) REFERENCES `concept` (`concept_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_request_item_refout_sample_fk` FOREIGN KEY (`referral_out_sample_id`) REFERENCES `labmgmt_sample` (`sample_id`),
  CONSTRAINT `labmgmt_test_request_item_request_approval_by_fk` FOREIGN KEY (`request_approval_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_request_item_request_fk` FOREIGN KEY (`test_request_id`) REFERENCES `labmgmt_test_request` (`test_request_id`),
  CONSTRAINT `labmgmt_test_request_item_to_location_fk` FOREIGN KEY (`to_location_id`) REFERENCES `location` (`location_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_request_item_voided_by_fk` FOREIGN KEY (`voided_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;


-- esmugemr.labmgmt_test_request_item_sample definition

CREATE TABLE `labmgmt_test_request_item_sample` (
  `test_request_item_sample_id` int NOT NULL AUTO_INCREMENT,
  `test_request_item_id` int NOT NULL,
  `sample_id` int NOT NULL,
  `creator` int NOT NULL DEFAULT '0',
  `date_created` datetime NOT NULL,
  `changed_by` int DEFAULT NULL,
  `date_changed` datetime DEFAULT NULL,
  `voided` tinyint(1) NOT NULL DEFAULT '0',
  `voided_by` int DEFAULT NULL,
  `date_voided` datetime DEFAULT NULL,
  `void_reason` varchar(255) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci DEFAULT NULL,
  `uuid` char(38) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci NOT NULL,
  PRIMARY KEY (`test_request_item_sample_id`),
  UNIQUE KEY `labmgmt_test_request_item_sample_uuid_ux` (`uuid`),
  KEY `labmgmt_test_request_item_sample_req_fk` (`test_request_item_id`),
  KEY `labmgmt_test_request_item_sample_fk` (`sample_id`),
  KEY `labmgmt_test_req_item_spl_changed_by_fk` (`changed_by`),
  KEY `labmgmt_test_req_item_spl_creator_fk` (`creator`),
  KEY `labmgmt_test_req_item_spl_voided_by_fk` (`voided_by`),
  CONSTRAINT `labmgmt_test_req_item_spl_changed_by_fk` FOREIGN KEY (`changed_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_req_item_spl_creator_fk` FOREIGN KEY (`creator`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_req_item_spl_voided_by_fk` FOREIGN KEY (`voided_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_request_item_sample_fk` FOREIGN KEY (`sample_id`) REFERENCES `labmgmt_sample` (`sample_id`),
  CONSTRAINT `labmgmt_test_request_item_sample_req_fk` FOREIGN KEY (`test_request_item_id`) REFERENCES `labmgmt_test_request_item` (`test_request_item_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;


-- esmugemr.labmgmt_test_result definition

CREATE TABLE `labmgmt_test_result` (
  `test_result_id` int NOT NULL AUTO_INCREMENT,
  `worksheet_item_id` int DEFAULT NULL,
  `sample_id` int NOT NULL,
  `order_id` int NOT NULL,
  `test_request_item_id` int NOT NULL,
  `at_location_id` int NOT NULL,
  `obs_id` int NOT NULL,
  `result_by` int NOT NULL DEFAULT '0',
  `status` varchar(50) NOT NULL,
  `result_date` datetime NOT NULL,
  `require_approval` tinyint(1) NOT NULL,
  `current_approval_id` int DEFAULT NULL,
  `creator` int NOT NULL DEFAULT '0',
  `date_created` datetime NOT NULL,
  `changed_by` int DEFAULT NULL,
  `date_changed` datetime DEFAULT NULL,
  `voided` tinyint(1) NOT NULL DEFAULT '0',
  `voided_by` int DEFAULT NULL,
  `date_voided` datetime DEFAULT NULL,
  `void_reason` varchar(255) DEFAULT NULL,
  `uuid` char(38) NOT NULL,
  `additional_tests_required` bit(1) DEFAULT NULL,
  `archive_sample` bit(1) DEFAULT NULL,
  `sample_activity_id` int DEFAULT NULL,
  `remarks` varchar(1000) DEFAULT NULL,
  PRIMARY KEY (`test_result_id`),
  UNIQUE KEY `uuid` (`uuid`),
  KEY `labmgmt_test_result_changed_by_fk` (`changed_by`),
  KEY `labmgmt_test_result_creator_fk` (`creator`),
  KEY `labmgmt_test_result_obs_fk` (`obs_id`),
  KEY `labmgmt_test_result_order_fk` (`order_id`),
  KEY `labmgmt_test_result_result_by_fk` (`result_by`),
  KEY `labmgmt_test_result_sample_fk` (`sample_id`),
  KEY `labmgmt_test_result_test_request_item_fk` (`test_request_item_id`),
  KEY `labmgmt_test_result_voided_by_fk` (`voided_by`),
  KEY `labmgmt_test_result_worksheet_item_fk` (`worksheet_item_id`),
  KEY `labmgmt_test_result_sample_activity_fk` (`sample_activity_id`),
  CONSTRAINT `labmgmt_test_result_changed_by_fk` FOREIGN KEY (`changed_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_result_creator_fk` FOREIGN KEY (`creator`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_result_obs_fk` FOREIGN KEY (`obs_id`) REFERENCES `obs` (`obs_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_result_order_fk` FOREIGN KEY (`order_id`) REFERENCES `orders` (`order_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_result_result_by_fk` FOREIGN KEY (`result_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_result_sample_activity_fk` FOREIGN KEY (`sample_activity_id`) REFERENCES `labmgmt_sample_activity` (`sample_activity_id`),
  CONSTRAINT `labmgmt_test_result_sample_fk` FOREIGN KEY (`sample_id`) REFERENCES `labmgmt_sample` (`sample_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_result_test_request_item_fk` FOREIGN KEY (`test_request_item_id`) REFERENCES `labmgmt_test_request_item` (`test_request_item_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_result_voided_by_fk` FOREIGN KEY (`voided_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_result_worksheet_item_fk` FOREIGN KEY (`worksheet_item_id`) REFERENCES `labmgmt_worksheet_item` (`worksheet_item_id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;


-- esmugemr.labmgmt_test_result_document definition

CREATE TABLE `labmgmt_test_result_document` (
  `test_result_document_id` int NOT NULL AUTO_INCREMENT,
  `test_result_id` int NOT NULL,
  `document_type` varchar(50) NOT NULL,
  `document_name` varchar(256) NOT NULL,
  `document_provider` tinyint NOT NULL,
  `document_provider_ref` varchar(1024) DEFAULT NULL,
  `remarks` varchar(500) DEFAULT NULL,
  `creator` int NOT NULL DEFAULT '0',
  `date_created` datetime NOT NULL,
  `changed_by` int DEFAULT NULL,
  `date_changed` datetime DEFAULT NULL,
  `voided` tinyint(1) NOT NULL DEFAULT '0',
  `voided_by` int DEFAULT NULL,
  `date_voided` datetime DEFAULT NULL,
  `void_reason` varchar(255) DEFAULT NULL,
  `uuid` char(38) NOT NULL,
  PRIMARY KEY (`test_result_document_id`),
  UNIQUE KEY `uuid` (`uuid`),
  KEY `labmgmt_test_result_document__test_result_fk` (`test_result_id`),
  KEY `labmgmt_test_result_document_changed_by_fk` (`changed_by`),
  KEY `labmgmt_test_result_document_creator_fk` (`creator`),
  KEY `labmgmt_test_result_document_voided_by_fk` (`voided_by`),
  CONSTRAINT `labmgmt_test_result_document__test_result_fk` FOREIGN KEY (`test_result_id`) REFERENCES `labmgmt_test_result` (`test_result_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_result_document_changed_by_fk` FOREIGN KEY (`changed_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_result_document_creator_fk` FOREIGN KEY (`creator`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_test_result_document_voided_by_fk` FOREIGN KEY (`voided_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;


-- esmugemr.labmgmt_worksheet definition

CREATE TABLE `labmgmt_worksheet` (
  `worksheet_id` int NOT NULL AUTO_INCREMENT,
  `at_location_id` int NOT NULL,
  `worksheet_date` datetime NOT NULL,
  `test_id` int DEFAULT NULL,
  `diagnosis_type_id` int DEFAULT NULL,
  `status` varchar(50) NOT NULL,
  `responsible_person` int DEFAULT NULL,
  `creator` int NOT NULL DEFAULT '0',
  `responsible_person_other` varchar(150) DEFAULT NULL,
  `date_created` datetime NOT NULL,
  `changed_by` int DEFAULT NULL,
  `date_changed` datetime DEFAULT NULL,
  `voided` tinyint(1) NOT NULL DEFAULT '0',
  `voided_by` int DEFAULT NULL,
  `date_voided` datetime DEFAULT NULL,
  `void_reason` varchar(255) DEFAULT NULL,
  `uuid` char(38) NOT NULL,
  PRIMARY KEY (`worksheet_id`),
  UNIQUE KEY `uuid` (`uuid`),
  KEY `labmgmt_worksheet_at_location_fk` (`at_location_id`),
  KEY `labmgmt_worksheet_changed_by_fk` (`changed_by`),
  KEY `labmgmt_worksheet_creator_fk` (`creator`),
  KEY `labmgmt_worksheet_responsible_person_fk` (`responsible_person`),
  KEY `labmgmt_worksheet_voided_by_fk` (`voided_by`),
  CONSTRAINT `labmgmt_worksheet_at_location_fk` FOREIGN KEY (`at_location_id`) REFERENCES `location` (`location_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_worksheet_changed_by_fk` FOREIGN KEY (`changed_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_worksheet_creator_fk` FOREIGN KEY (`creator`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_worksheet_responsible_person_fk` FOREIGN KEY (`responsible_person`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_worksheet_voided_by_fk` FOREIGN KEY (`voided_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;


-- esmugemr.labmgmt_worksheet_item definition

CREATE TABLE `labmgmt_worksheet_item` (
  `worksheet_item_id` int NOT NULL AUTO_INCREMENT,
  `worksheet_id` int NOT NULL,
  `sample_id` int NOT NULL,
  `status` varchar(50) NOT NULL,
  `completed_date` datetime DEFAULT NULL,
  `cancelled_date` datetime DEFAULT NULL,
  `cancellation_remarks` varchar(500) DEFAULT NULL,
  `creator` int NOT NULL DEFAULT '0',
  `date_created` datetime NOT NULL,
  `changed_by` int DEFAULT NULL,
  `date_changed` datetime DEFAULT NULL,
  `voided` tinyint(1) NOT NULL DEFAULT '0',
  `voided_by` int DEFAULT NULL,
  `date_voided` datetime DEFAULT NULL,
  `void_reason` varchar(255) DEFAULT NULL,
  `uuid` char(38) NOT NULL,
  `test_request_item_id` int DEFAULT NULL,
  PRIMARY KEY (`worksheet_item_id`),
  UNIQUE KEY `uuid` (`uuid`),
  KEY `labmgmt_worksheet_item_changed_by_fk` (`changed_by`),
  KEY `labmgmt_worksheet_item_creator_fk` (`creator`),
  KEY `labmgmt_worksheet_item_sample_fk` (`sample_id`),
  KEY `labmgmt_worksheet_item_voided_by_fk` (`voided_by`),
  KEY `labmgmt_worksheet_item_worksheet_fk` (`worksheet_id`),
  KEY `labmgmt_worksheet_item_test_req_item_fk` (`test_request_item_id`),
  CONSTRAINT `labmgmt_worksheet_item_changed_by_fk` FOREIGN KEY (`changed_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_worksheet_item_creator_fk` FOREIGN KEY (`creator`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_worksheet_item_sample_fk` FOREIGN KEY (`sample_id`) REFERENCES `labmgmt_sample` (`sample_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_worksheet_item_test_req_item_fk` FOREIGN KEY (`test_request_item_id`) REFERENCES `labmgmt_test_request_item` (`test_request_item_id`),
  CONSTRAINT `labmgmt_worksheet_item_voided_by_fk` FOREIGN KEY (`voided_by`) REFERENCES `users` (`user_id`) ON DELETE RESTRICT ON UPDATE RESTRICT,
  CONSTRAINT `labmgmt_worksheet_item_worksheet_fk` FOREIGN KEY (`worksheet_id`) REFERENCES `labmgmt_worksheet` (`worksheet_id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb3;